<%= content_tag(:div, flash[:error], :id => "errorExplanation") unless flash[:error].nil? %>

<div class="splitcontentleft" style="width:65%;">
  <% is_all = @version.checklists.where("all_users='y'") %>
  <% users = @version.checklists.where('user_id is not null') %>

  <% if users.any? || is_all.any? %>
    <table class="list users">
      <thead><tr>
        <th><%= l(:label_user) %></th>
        <th style="width:15%"></th>
      </tr></thead>
      <tbody>
      <% is_all.each do |rec| %>
        <tr id="rec-<%= rec.id %>" class="<%= cycle 'odd', 'even' %>">
          <td class="user"><%= rec.display_name %></td>
          <td class="buttons">
            <%= link_to_remote( l(:button_delete),
                                { :url => "remove_checklist/#{rec.id}",
                                  :method => :delete },
                                :class => 'icon icon-del' ) %>
          </td>
        </tr>      
      <% end %>        
      <% users.sort_by{|el| el.display_name}.each do |rec| %>
        <tr id="rec-<%= rec.id %>" class="<%= cycle 'odd', 'even' %>">
          <td class="user"><%= link_to_user User.find(rec.user_id) %></td>
          <td class="buttons">
            <%= link_to_remote( l(:button_delete),
                                { :url => "remove_checklist/#{rec.id}",
                                  :method => :delete },
                                :class => 'icon icon-del' ) %>
          </td>
        </tr>
      <% end %>
      </tbody>
    </table>
  <% else %>
    <p class="nodata"><%= l(:label_no_data) %></p>
  <% end %>  
</div>

<div class="splitcontentright" style="width:30%;">
  <%= form_tag({:action => "checklist"},{:class=>'select_checklist_form', :id =>'select_users', :remote => true}) do %>
    <input type=hidden name="tab_refresh" value="users">
    <fieldset><legend><strong> <%= l(:label_docflows_users) %> </strong></legend>    
      <p>
        <label><%= check_box_tag("all_users", 'y') %> <%= l(:label_docflows_all_users) %></label>
      </p>
      <% users = User.active.not_in_version(@version).all(:limit => 100) %>

      <p><%= text_field_tag('filter_people', '', :class => 'find-filter') %></p>
      <%= observe_field(:filter_people,
                   :frequency => 0.5,
                   :update => :users_list,
                   :url => autocomplete_for_user_docflow_version_path(@version),
                   :method => :get,
                   :before => "jQuery('#filter_people').addClass('ajax-loading')",
                   :complete => "jQuery('#filter_people').removeClass('ajax-loading')",
                   :with => 'q')
                    %>    
      <div id="users_list" class="list-container">
        <%= principals_check_box_tags "users[]", users.sort_by{|el| el.name.to_s} %>
      </div>

      <p>
      <%= submit_tag(l(:label_docflow_add_item), :id => 'record_add', :class => 'btn-def') %>
      <%= link_to l(:label_docflow_done), @version, :class => 'btn-def' %>
      </p>       
    </fieldset>
  <% end %>
 </div>